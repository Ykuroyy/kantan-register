# 🧾 Kantan Register

**高齢者にもやさしい、シンプルで直感的に使えるAI画像認識Webレジアプリケーション。**  
Rails × Python（Flask）で構築し、商品登録・撮影認識・売上分析まで一括管理。

---

## Overview
【アプリ概要】
本アプリは、個人経営または小規模なパン屋を対象に開発した、画像認識ベースのレジ支援システムです。商品にバーコードが存在しないことが多いパン屋の販売現場において、手動での商品入力作業を不要とし、販売業務の効率化とヒューマンエラーの削減を実現します。
開発者自身がパン屋の販売現場でレジ業務を経験した際、頻繁な価格変更と記憶負荷の大きさに課題を感じたことが出発点です。「価格の記憶」や「手入力」に伴う業務負荷を削減し、スタッフが本来注力すべき接客や製造に集中できる環境を作りたいという思いから、本アプリの開発に至りました。

【課題】
パン屋では、以下のような業務課題が存在しています：
・商品にバーコードがないため、レジ入力は手動が基本
・原材料価格の高騰により、販売価格が頻繁に変動
・商品名や価格の記憶負荷が販売スタッフにのしかかる
・高機能レジ（BakeryScan、スマレジ等）は導入コストや運用ハードルが高く、個人店では導入が難しい
これらの課題は、販売機会損失・金銭的損失・スタッフの心理的負担を引き起こし、業務効率に大きな影響を与えます。

【解決策としての本アプリの特徴】
本アプリでは、Rails × Python × AI画像認識を用いて、以下を実現しています：
・パンの画像から商品名と価格を即座に判定し、画面に表示
・登録済みの商品情報をもとに、販売時はカメラで撮影するだけでレジ操作が完結
・UI/UXを業務特化型に設計し、ITリテラシーが高くないスタッフでも直感的に操作可能
・シンプルかつ低コストな構成により、個人店でも導入可能なスケーラビリティを担保

---


## URL
Railsアプリケーション: https://kantan-register.onrender.com  
AI画像認識サーバー(Flask): https://ai-server-f6si.onrender.com (Railsアプリから内部的に呼び出されます)

---

## Basic 認証 
- ユーザー名：`admin`  
- パスワード：`2222`  

---


## 主な機能

| 機能 | 説明 |
|------|------|
| **商品管理** | カタカナのみの名前制約、価格バリデーション |
| **画像アップロード** | ActiveStorage (S3連携)＋カメラ撮影 |
| **AI画像認識レジ** | FlaskでSSIM/SIFT/ORBを用いた商品特定 |
| **キーワード検索レジ** | 商品名キーワード検索でカートに追加 |
| **カート管理** | 商品追加・数量更新・カートクリア |
| **売上分析ダッシュボード** | 年次/月次/日次のグラフとサマリー表示 |
| **管理リセット機能** | `/admin/reset_all?token=...` |
| **Basic認証** | 管理画面に認証を適用 |


---

## テクノロジー

### Rails サイド

- Ruby 3.2.0 / Rails 7.1.5.1 
- データベース: MySQL 8.0（開発環境）、PostgreSQL（本番環境 on Render.com）
- アセットパイプライン: Sprockets (主に `app/assets` を使用)
- フロントエンド: Turbo Drive, Stimulus.js
- 画像管理: ActiveStorage (Amazon S3 に画像を保存)
- 売上分析: groupdate gem
- グラフ描画: Chart.js

本番環境では、Railsが `url_for(@product.image, host: ...)` を使ってS3上の画像URLを生成し、FlaskサーバーはこのURLから `requests.get(image_url)` を用いて画像データを取得・処理します。

### Python（画像認識）サイド

- Python 3.13.2  
- Flask 3.1.1
- Pillow (PIL Fork)
- NumPy
- scikit-image (SSIM計算用)
- OpenCV (ORB/SIFT特徴量抽出用)
- gunicorn  
- Flask-CORS  
- requests 2.31.0
- SQLAlchemy 2.0.20 / psycopg2-binary 2.9.6（本番でDBマッピングを使う場合）


#### `requirements.txt` 抜粋
<!-- このセクションは、主要なライブラリとそのバージョンを記載するのに役立ちます -->
```text
Flask==3.1.1
Pillow==11.2.1
numpy==2.2.6
scikit-image==0.25.2
opencv-python==4.11.0.86
gunicorn==23.0.0
Flask-CORS==6.0.0
requests==2.32.3
SQLAlchemy==2.0.20
psycopg2-binary==2.9.6
boto3==1.38.23

```


## 画面遷移
- **トップ** → 商品一覧 → 新規登録／編集
- **レジ画面** → カメラ認識 or キーワード → カート追加
- **カート画面** → 数量更新 → 会計
- **注文完了** → 履歴保存
- **売上分析** → 年次／月次／日次の切替

## データベース設計（一部）

### products テーブル
| Column      | Type     | Options                         |
|-------------|----------|---------------------------------|
| `name`      | string   | null: false, format: katakana   |
| `price`     | integer  | null: false, numericality: >0   |
| `s3_key`    | string   | 登録済み画像の S3 キー保存用        |
| `created_at`| datetime |                                 |
| `updated_at`| datetime |                                 |



### orders / order_items テーブル
- `orders`      : 購入トランザクション  
- `order_items` : 商品×数量×価格の中間テーブル  


## データベース構造図（ER図）

![ER図](kantan-register-er-diagram.png)

## 画面遷移図（ビジュアル）

![画面遷移図](kantan-register-flow.png)


## 開発背景
- 小規模店舗やイベント出店での手軽な POS を目指して開発 
- Flask で画像認識処理を切り出し、Rails とは疎結合化
- シンプル UI で誰でも扱いやすい

## 注意事項（ご利用前にお読みください）

- 商品を登録・編集・削除した場合は、**必ず「AIサーバーのキャッシュを再構築」ボタンを押してください**。  
  → これを行わないと、Flask側の認識結果に反映されません。

- 商品を撮影する際は、以下を心がけてください：  
  - **背景は白色**にする（例：白テーブル・白い紙の上など）  
  - 商品が**画面の80％程度を占める大きさ**になるように調整  
  - **ピントをしっかり合わせてから撮影**する  

上記を守ることで、AI画像認識の精度が大きく向上します。


## 使い方
1. **トップページ** → 商品登録  
2. **レジ画面** → 「撮影する」
3. 画像認識 or キーワードでカートに追加  
4. **会計** → 注文完了  
5. **売上分析** タブ切替 （グラフ表示で売上を可視化） 



## 📱 スマホ操作デモ（録画）
実際のレジ操作の様子を動画で確認できます：

- [🆕 新規商品登録 → AIキャッシュ再構築の流れ](https://i.gyazo.com/31e1a58c9cbf006d1d09f5e50cfe6e32.gif)
- [📸 レジ画面①：カメラ撮影 → 商品認識 → 会計完了](https://i.gyazo.com/0faad65d0ece249a0482196c472e7b0a.gif)
- [🛒 レジ画面②：カメラ撮影 → カート編集 → 会計完了](https://i.gyazo.com/78706e029cdd0edc752c25403b908f11.gif)
- [📊 分析画面：日別 → 月間 → 年間](https://i.gyazo.com/47951c9c86bac043f663c11b9346a0dc.gif)



## 今後の予定
- 在庫数アラート  
- 複数店舗対応  
- Web プッシュ通知
- レスポンシブ改善／ダークモード  

## 制作時間
約 **140時間**

---