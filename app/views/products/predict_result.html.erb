<div class="container">
  <%= link_to "トップページに戻る", root_path, class: "btn btn-gray" %>

  <h2 class="form-heading">🔍 認識結果</h2>

    <!-- 画像 2 枚を並べる -->
    <div class="grid">
      <!-- 撮影した画像 -->
      <div class="card">
        <p class="preview-label">撮影した画像</p>
        <%= image_tag "",
              id:    "recognized-preview-image",
              class: "preview-image",
              style: "display:none; max-width:100%;",
              alt:   "撮影画像プレビュー" %>
      </div>

      <!-- 登録済み商品画像 -->
      <div class="card">
        <p class="preview-label">登録されている商品画像</p>
        <% if @product&.image&.attached? %>
          <%= image_tag @product.image.variant(resize_to_limit: [320, 320]), class: "preview-image" %>
        <% else %>
          <div class="preview-image no-image">画像なし</div>
        <% end %>
      </div>
    </div>

  <%# ここから置き換え %>
    <!-- ベストマッチ -->
    <p style="margin-top:1rem;">
      ベストマッチ：
      <strong><%= @best_product&.name || @best["name"] %></strong>
      (<%= (@best["score"] * 100).round(1) %>%)
    </p>

    <!-- ここから「カートに追加」フォーム -->
    <%= form_with url: add_to_cart_products_path, method: :post, local: true do %>
      <%= hidden_field_tag :recognized_name, (@best_product&.name || @best["name"]) %>
      <%= submit_tag "カートに追加", class: "btn btn-yellow", style: "margin-bottom:1rem;" %>
    <% end %>
    <!-- ここまで「カートに追加」フォーム -->

    <!-- 類似候補 -->
    <% if @candidates.any? %>
      <h3 style="margin-top:1.5rem;">🔎 類似候補</h3>
      <ul style="display:flex;gap:1rem;flex-wrap:wrap;">
        <% @candidates.each do |c| %>
          <% prod = Product.find_by(name: c["name"]) %>
          <li style="list-style:none;text-align:center;width:100px;">
            <% if prod&.image&.attached? %>
              <%= image_tag prod.image.variant(resize_to_limit:[100,100]),
                            alt: prod.name,
                            style: "border:1px solid #ccc;border-radius:4px;" %>
            <% else %>
              <div style="width:100px;height:100px;background:#f0f0f0;
                          display:flex;align-items:center;justify-content:center;
                          font-size:0.8em;color:#666;">
                no image
              </div>
            <% end %>
            <p style="margin:0.4em 0 0;font-size:0.9em;">
              <%= prod&.name || c["name"] %><br>
              (<%= (c["score"] * 100).round(1) %>%)
            </p>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p style="text-align:center;color:#c00;margin-top:1rem;">
        一致する商品はありませんでした。
      </p>
    <% end %>
  <%# ここまで置き換え %>



    <!-- 撮影をやり直す -->
    <%= link_to "撮影をやり直す",
        camera_products_path(mode: "order"),
        class: "btn btn-blue",
        style: "margin-top:1.2rem;" %>

    <!-- レジに戻る -->
    <%= link_to "レジに戻る",
        new_order_products_path,
        class: "btn btn-gray",
        style: "margin-top:.6rem;" %>
  </div>
</div>

