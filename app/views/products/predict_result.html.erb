<%= link_to "ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹", root_path, class: "form-button gray" %>
<h2 class="form-heading">ğŸ” èªè­˜çµæœ</h2>

<div class="form-container">
  <div class="form-card">
    <div class="image-group predict-images">
      <!-- æ’®å½±ã—ãŸç”»åƒ -->
      <div class="image-block">
        <p class="preview-label">æ’®å½±ã—ãŸç”»åƒ</p>
        <img id="recognized-preview-image"
             class="preview-image"
             style="display:none; max-width:100%;"
             alt="æ’®å½±ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" />
      </div>
      <!-- ç™»éŒ²æ¸ˆã¿å•†å“ç”»åƒ -->
      <div class="image-block">
        <p class="preview-label">ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å•†å“ç”»åƒ</p>
        <% if @product&.image&.attached? %>
          <%= image_tag(@product.image.variant(resize_to_limit: [320, 320]), class: "preview-image") %>
        <% else %>
          <div class="preview-image no-image">ç”»åƒãªã—</div>
        <% end %>
      </div>
    </div>

    <% if @product.present? %>
      <!-- å•†å“ãƒ’ãƒƒãƒˆæ™‚ -->
      <p>å•†å“åï¼š<strong><%= @product.name %></strong></p>
      <p>ä¾¡æ ¼ï¼šÂ¥<%= number_with_delimiter(@product.price) %></p>
      <% if @score.present? %>
        <p>é¡ä¼¼åº¦ã‚¹ã‚³ã‚¢ï¼š<%= (@score * 100).round(1) %>%</p>
        <p style="font-size:0.9em; color:gray;">â€»0ã€œ100%ã§é¡ä¼¼åº¦ã‚’è¡¨ç¤º</p>
      <% end %>
      <%= form_with url: add_to_cart_products_path, method: :post, local: true do %>
        <%= hidden_field_tag :recognized_name, @product.name %>
        <%= submit_tag "ã‚«ãƒ¼ãƒˆã«è¿½åŠ ", class: "form-button yellow" %>
      <% end %>
    <% else %>
      <!-- ãƒ’ãƒƒãƒˆãªã—: å†æ’®å½±ã®ã¿ -->
      <p style="text-align:center; color:#666;">ä¸€è‡´ã™ã‚‹å•†å“ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>
    <% end %>

    <!-- æ’®å½±ã‚’ã‚„ã‚Šç›´ã™ -->
    <%= link_to "æ’®å½±ã‚’ã‚„ã‚Šç›´ã™", camera_products_path(mode: "order"), class: "form-button blue", style: "margin-top:16px;" %>

    <!-- ãƒ¬ã‚¸ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
    <%= link_to "ãƒ¬ã‚¸ã«æˆ»ã‚‹", new_order_products_path, class: "form-button gray", style: "margin-top:8px;" %>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const imgData = sessionStorage.getItem("capturedImage");
    const imgEl = document.getElementById("recognized-preview-image");
    if (imgData && imgEl) {
      imgEl.src = imgData;
      imgEl.style.display = "block";
      sessionStorage.removeItem("capturedImage");
    }
  });
</script>