<div id="camera-container"
     data-mode="<%= params[:mode] %>"
     data-product-id="<%= params[:product_id] %>"
     data-image-url="<%= @product.image.service_url if @product&.image&.attached? %>">

  <%= link_to "ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹", root_path, class: "btn btn-gray" %>

  <h2 class="form-heading">ğŸ“· ã‚«ãƒ¡ãƒ©ã§æ’®å½±</h2>

  <div class="card">
    <!-- ãƒ©ã‚¤ãƒ–æ˜ åƒ -->
    <video id="video"
           autoplay
           playsinline
           muted
           style="max-width:100%; height:auto; border-radius:12px; margin-bottom:1rem;">
    </video>

    <!-- æ’®å½±ãƒœã‚¿ãƒ³ -->
    <div style="text-align:center; margin-bottom:1rem;">
      <button id="capture-photo" class="btn btn-blue">æ’®å½±ã™ã‚‹</button>
    </div>

    <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã‚¤ãƒ¡ãƒ¼ã‚¸ -->
    <img id="preview"
         style="display:none; max-width:100%; border-radius:12px; margin-bottom:1rem;"
         alt="æ’®å½±ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" />

    <!-- æˆ»ã‚‹ãƒªãƒ³ã‚¯ç¾¤ -->
    <div style="text-align:center; margin-top:1rem; display:flex; gap:.6rem; flex-wrap:wrap; justify-content:center;">
      <% case params[:mode] %>
      <% when "edit" %>
        <%= link_to "å•†å“ç·¨é›†ã«æˆ»ã‚‹",
                    edit_product_path(params[:product_id]),
                    class: "btn btn-gray" %>
      <% when "new" %>
        <%= link_to "å•†å“ç™»éŒ²ã«æˆ»ã‚‹",
                    new_product_path,
                    class: "btn btn-gray" %>
      <% else %>
        <%= link_to "ãƒ¬ã‚¸ç”»é¢ã«æˆ»ã‚‹",
                    new_order_products_path,
                    class: "btn btn-gray" %>
      <% end %>
    </div>
  </div>

  <!-- hidden canvas for capture -->
  <canvas id="canvas" style="display:none;"></canvas>
</div>

<!-- app/views/products/camera.html.erb ã®ä¸€ç•ªä¸‹ã«è¿½åŠ  -->
<%= javascript_include_tag "camera", defer: true %>